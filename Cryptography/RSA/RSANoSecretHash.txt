> # ----------------------------------------------
> # Подпись RSA без секретной передачи сообщения (c хэшированием).
> # ----------------------------------------------
> with(numtheory):
> hash := (x) -> x mod 7;
> # ----------------------------------------------
> # 1. Выбор первого открытого ключа M
> # ----------------------------------------------
> p1 := nextprime(256512);
> p2 := nextprime(2565121024);
> M := p1*p2;
> # ----------------------------------------------
> # 2. Выбор закрытого ключа d
> # ----------------------------------------------
> d:=nextprime(12288);
> verify(igcd(d, (p1 - 1) * (p2 - 1)), 1, 'equal'); # Проверка выбора ключа
> # ------------------------------------
> # 3. Выбор второго открытого ключа e
> # ------------------------------------
> e := d &^ (phi((p1 - 1) * (p2 - 1))-1) mod ((p1 - 1) * (p2 - 1));
> # ------------------------------------
> # 4. Публикация пары (e, M) и выбор текста x для подписи
> # ------------------------------------
> x := 12345678901234567890 mod M;
> # --------------------------------------
> # 5. Вычисление подписи
> # -----------------------------------------
> s := hash(x) &^ d mod M;  # Вычисление подписи 
> # -------------------------------------------
> # 6. Верификация
> # -------------------------------------------
> x1 := s &^ e mod M;
> verify(hash(x) - x1, 0, 'equal');
x -> `mod`(x, 7)
                                   256517
                                 2565121037
                               657997153048129
                                    12289
                                    true
                               86151297222065
                               336315745571592
                               503736290981637
                                      3
                                    true
> 
